
<!DOCTYPE html>
<html>
	<head><title>Echo</title></head>
	<body>
	<script>
		var wss = new WebSocket('wss://127.0.0.1/echo');

		// Incoming messages
		wss.onmessage = function(event){
			//document.body.innerHTML += event.data + '<BR>';
			document.getElementById('data_output').innerHTML += event.data +"<BR>";
		};

		// Outgoing messages
		wss.newmessage = function() {
			var name = document.getElementById('user').value;
			var msg = document.getElementById('msg').value;
			wss.send(JSON.stringify({
				id: name,
				data: msg
			}));
		};
	</script>
	<%= link_to "Logout" => 'auth_logout' %><BR><BR>
	<%= link_to "Show messages Log" => 'echo_show' %>
	<BR><BR>
	Websocket Echos<BR><BR>
	New Message:
<%= hidden_field user => $user, id => 'user' %>
<%= text_field 'msg', id => 'msg', value => $msg %>
<input type="submit" id="submit" value="Send" onClick="wss.newmessage();">

<BR><BR>
Chat Output:<BR>
<div id="data_output"></div>
New Output
<%= $message %>
<%= $time %>
<%= $user %>
	</body>
</html>	